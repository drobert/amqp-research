<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:c="http://www.springframework.org/schema/c"
	xmlns:int="http://www.springframework.org/schema/integration"
	xmlns:int-amqp="http://www.springframework.org/schema/integration/amqp"
	xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/integration/amqp http://www.springframework.org/schema/integration/amqp/spring-integration-amqp-4.0.xsd
		http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration-4.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd">

	<context:property-placeholder />
	<import resource="amqp-context.xml" />
	
	<int:channel id="clicksIn">
		<int:interceptors>
			<int:wire-tap channel="errorLogger" />
		</int:interceptors>	
	</int:channel>
	
	<int:channel id="clicksOut">
		<int:interceptors>
			<int:wire-tap channel="errorLogger" />
		</int:interceptors>	
	</int:channel>
	
	<int:logging-channel-adapter id="errorLogger" level="INFO" logger-name="STDERR" />

	<int-amqp:inbound-channel-adapter channel="clicksIn" queue-names="${mq.queue.clicksIn.name:clicks_in}" connection-factory="amqpConnectionFactory" />

<!-- 	<int-amqp:inbound-gateway request-channel="clicksIn" queue-names="${mq.queue.clicksIn.name:clicks_in}" connection-factory="amqpConnectionFactory" /> -->
	<int-amqp:outbound-channel-adapter channel="clicksOut" amqp-template="amqpTemplate" routing-key="${mq.queue.clicksOut.name:clicks_out}" />
	
	<bean id="clickHandler" class="name.danielrobert.amqp.NinetiesClickHandler" />
	
	<int:service-activator input-channel="clicksIn" ref="clickHandler" method="processClick" output-channel="clicksOut" />
	
<!-- 	<int:gateway default-reply-channel="clicksOut" default-request-channel="clicksIn" service-interface="name.danielrobert.amqp.ClickHandler"> -->
<!-- 		<int:method name="processClick" /> -->
<!-- 	</int:gateway> -->

</beans>
